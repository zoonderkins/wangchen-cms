<!-- Include Quill stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold">
            <%= article ? 'Edit Article' : 'Create New Article' %>
        </h1>
        <a href="/admin/articles" class="text-gray-600 hover:text-gray-900">
            <i class="fas fa-arrow-left mr-2"></i> Back to Articles
        </a>
    </div>

    <form action="<%= article ? `/admin/articles/edit/${article.id}` : '/admin/articles' %>" method="POST"
        class="bg-white rounded-lg shadow-sm p-6" id="articleForm" onsubmit="return handleSubmit()">
        <input type="hidden" name="id" value="<%= article ? article.id : '' %>">

        <!-- Title -->
        <div class="mb-6">
            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Title</label>
            <input type="text" id="title" name="title" value="<%= article ? article.title : '' %>" required
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Category -->
        <div class="mb-6">
            <label for="categoryId" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
            <select id="categoryId" name="categoryId" required
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Select Category</option>
                <% categories.forEach(function(category) { %>
                    <option value="<%= category.id %>" <%= article && article.categoryId === category.id ? 'selected' : '' %>>
                        <%= category.name %>
                    </option>
                <% }); %>
            </select>
        </div>

        <!-- Content -->
        <div class="mb-6">
            <label for="editor" class="block text-sm font-medium text-gray-700 mb-2">Content</label>
            <div id="editor" style="height: 400px;"><%- article ? article.content : '' %></div>
            <input type="hidden" name="content" id="content">
        </div>

        <!-- Excerpt -->
        <div class="mb-6">
            <label for="excerpt" class="block text-sm font-medium text-gray-700 mb-2">
                Excerpt
                <span class="text-gray-500 text-xs">(Optional)</span>
            </label>
            <textarea id="excerpt" name="excerpt" rows="3"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"><%= article ? article.excerpt : '' %></textarea>
        </div>

        <!-- Published Status -->
        <div class="mb-6">
            <label class="flex items-center">
                <input type="checkbox" name="published" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                    <%= article && article.status === 'published' ? 'checked' : '' %>>
                <span class="ml-2 text-sm text-gray-600">Published</span>
            </label>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end">
            <button type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                <%= article ? 'Update' : 'Create' %> Article
            </button>
        </div>
    </form>
</div>

<!-- Include Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    // Initialize Quill editor
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image', 'video'],
                ['clean']
            ]
        }
    });

    // Handle form submission
    function handleSubmit() {
        // Get the HTML content from Quill editor
        var content = quill.root.innerHTML;
        // Set the content to the hidden input
        document.getElementById('content').value = content;

        // Log form data
        console.log('Form data:', {
            id: document.getElementById('id').value,
            title: document.getElementById('title').value,
            categoryId: document.getElementById('categoryId').value,
            content: content,
            excerpt: document.getElementById('excerpt').value,
            published: document.querySelector('input[name="published"]').checked
        });

        return true;
    }
</script>