<%- contentFor('body') %>

  <div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">Contact Submissions</h1>
      <a href="/admin/contact/categories" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        <i class="fas fa-cog mr-2"></i> Manage Categories
      </a>
    </div>

    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
      <!-- Filters -->
      <div class="mb-6">
        <form action="/admin/contact" method="GET" class="flex flex-wrap items-end gap-4">
          <div>
            <label class="block text-gray-700 text-sm font-bold mb-2" for="category">
              Category
            </label>
            <select
              class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="category" name="category">
              <option value="">All Categories</option>
              <% categories.forEach(function(category) { %>
                <option value="<%= category.id %>" <%=currentCategory==category.id ? 'selected' : '' %>>
                  <%= category.name_en %> / <%= category.name_tw %>
                </option>
                <% }); %>
            </select>
          </div>
          <div>
            <label class="block text-gray-700 text-sm font-bold mb-2" for="status">
              Status
            </label>
            <select
              class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="status" name="status">
              <option value="">All Statuses</option>
              <option value="pending" <%=currentStatus==='pending' ? 'selected' : '' %>>Pending</option>
              <option value="processed" <%=currentStatus==='processed' ? 'selected' : '' %>>Processed</option>
              <option value="archived" <%=currentStatus==='archived' ? 'selected' : '' %>>Archived</option>
            </select>
          </div>
          <div>
            <button type="submit"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
              <i class="fas fa-filter mr-2"></i> Filter
            </button>
          </div>
          <div>
            <a href="/admin/contact"
              class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
              <i class="fas fa-times mr-2"></i> Clear
            </a>
          </div>
        </form>
      </div>

      <% if (contacts && contacts.length> 0) { %>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white" id="dataTable">
            <thead>
              <tr class="bg-gray-100 text-gray-700 uppercase text-sm leading-normal">
                <th class="py-3 px-6 text-left">Date</th>
                <th class="py-3 px-6 text-left">Name</th>
                <th class="py-3 px-6 text-left">Email</th>
                <th class="py-3 px-6 text-left">Category</th>
                <th class="py-3 px-6 text-left">Status</th>
                <th class="py-3 px-6 text-center">Actions</th>
              </tr>
            </thead>
            <tbody class="text-gray-600 text-sm">
              <% contacts.forEach(function(contact) { %>
                <tr class="border-b border-gray-200 hover:bg-gray-50">
                  <td class="py-3 px-6 text-left">
                    <%= new Date(contact.createdAt).toLocaleDateString() %>
                  </td>
                  <td class="py-3 px-6 text-left">
                    <%= contact.name %>
                  </td>
                  <td class="py-3 px-6 text-left">
                    <%= contact.email %>
                  </td>
                  <td class="py-3 px-6 text-left">
                    <% if (contact.category) { %>
                      <%= contact.category.name_en %> / <%= contact.category.name_tw %>
                          <% } else { %>
                            <span class="text-gray-400">None</span>
                            <% } %>
                  </td>
                  <td class="py-3 px-6 text-left">
                    <% if (contact.status==='pending' ) { %>
                      <span class="bg-yellow-200 text-yellow-800 py-1 px-3 rounded-full text-xs">Pending</span>
                      <% } else if (contact.status==='processed' ) { %>
                        <span class="bg-green-200 text-green-800 py-1 px-3 rounded-full text-xs">Processed</span>
                        <% } else if (contact.status==='archived' ) { %>
                          <span class="bg-gray-200 text-gray-800 py-1 px-3 rounded-full text-xs">Archived</span>
                          <% } %>
                  </td>
                  <td class="py-3 px-6 text-center">
                    <div class="flex item-center justify-center">
                      <a href="/admin/contact/view/<%= contact.id %>"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded mr-2">
                        <i class="fas fa-eye"></i> View
                      </a>
                      <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded"
                        onclick="document.getElementById('deleteModal<%= contact.id %>').classList.remove('hidden')">
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </div>
                  </td>
                </tr>

                <!-- Delete Modal -->
                <div id="deleteModal<%= contact.id %>"
                  class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
                  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3 text-center">
                      <h3 class="text-lg leading-6 font-medium text-gray-900">Confirm Delete</h3>
                      <div class="mt-2 px-7 py-3">
                        <p class="text-sm text-gray-500">
                          Are you sure you want to delete this contact submission from <%= contact.name %>?
                        </p>
                      </div>
                      <div class="flex justify-center mt-4 px-4 py-3">
                        <button type="button"
                          class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mr-2"
                          onclick="document.getElementById('deleteModal<%= contact.id %>').classList.add('hidden')">
                          Cancel
                        </button>
                        <form action="/admin/contact/<%= contact.id %>/delete" method="POST">
                          <button type="submit"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                            Delete
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                <% }); %>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <% if (pagination.totalPages> 1) { %>
          <div class="flex justify-center mt-6">
            <nav class="inline-flex rounded-md shadow">
              <% if (pagination.page> 1) { %>
                <a href="/admin/contact?page=<%= pagination.page - 1 %><%= currentCategory ? '&category=' + currentCategory : '' %><%= currentStatus ? '&status=' + currentStatus : '' %>"
                  class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                  <span class="sr-only">Previous</span>
                  <i class="fas fa-chevron-left"></i>
                </a>
                <% } else { %>
                  <span
                    class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left"></i>
                  </span>
                  <% } %>

                    <% for (let i=1; i <=pagination.totalPages; i++) { %>
                      <% if (i===pagination.page) { %>
                        <span
                          class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-blue-50 text-sm font-medium text-blue-600">
                          <%= i %>
                        </span>
                        <% } else { %>
                          <a href="/admin/contact?page=<%= i %><%= currentCategory ? '&category=' + currentCategory : '' %><%= currentStatus ? '&status=' + currentStatus : '' %>"
                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                            <%= i %>
                          </a>
                          <% } %>
                            <% } %>

                              <% if (pagination.page < pagination.totalPages) { %>
                                <a href="/admin/contact?page=<%= pagination.page + 1 %><%= currentCategory ? '&category=' + currentCategory : '' %><%= currentStatus ? '&status=' + currentStatus : '' %>"
                                  class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                  <span class="sr-only">Next</span>
                                  <i class="fas fa-chevron-right"></i>
                                </a>
                                <% } else { %>
                                  <span
                                    class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                                    <span class="sr-only">Next</span>
                                    <i class="fas fa-chevron-right"></i>
                                  </span>
                                  <% } %>
            </nav>
          </div>
          <% } %>
            <% } else { %>
              <div class="text-center py-8">
                <p class="text-gray-500 mb-4">No contact submissions found.</p>
              </div>
              <% } %>
    </div>
  </div>