<%- contentFor('body') %>

    <div class="container px-6 mx-auto grid">
        <h2 class="my-6 text-2xl font-semibold text-gray-700">
            Create New Page
        </h2>

        <!-- Flash messages -->
        <% if (success_msg && success_msg.length> 0) { %>
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4" role="alert">
                <p>
                    <%= success_msg %>
                </p>
            </div>
            <% } %>

                <% if (error_msg && error_msg.length> 0) { %>
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert">
                        <p>
                            <%= error_msg %>
                        </p>
                    </div>
                    <% } %>

                        <!-- Page Creation Form -->
                        <div class="px-4 py-3 mb-8 bg-white rounded-lg shadow-md">
                            <form action="/admin/pages" method="POST" enctype="multipart/form-data" id="pageForm">
                                <!-- Title -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700" for="title">
                                        Page Title <span class="text-red-500">*</span>
                                    </label>
                                    <input
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        type="text" id="title" name="title" placeholder="Enter page title" required>
                                </div>

                                <!-- Editor Mode Toggle -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Editor Mode
                                    </label>
                                    <div class="flex">
                                        <div class="flex items-center mr-4">
                                            <input type="radio" id="editorMode-editor" name="editorMode" value="editor"
                                                checked
                                                class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                            <label for="editorMode-editor" class="ml-2 block text-sm text-gray-700">
                                                Rich Text Editor
                                            </label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="radio" id="editorMode-html" name="editorMode" value="html"
                                                class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                            <label for="editorMode-html" class="ml-2 block text-sm text-gray-700">
                                                Raw HTML
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Content -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700" for="editor">
                                        Page Content <span class="text-red-500">*</span>
                                    </label>
                                    <!-- Quill editor container -->
                                    <div id="editor"
                                        class="block w-full mt-1 text-sm border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        style="min-height: 300px;"></div>

                                    <!-- HTML textarea (initially hidden) -->
                                    <textarea id="htmlEditor"
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 hidden"
                                        style="min-height: 300px; font-family: monospace;"
                                        placeholder="Enter HTML content here"></textarea>

                                    <!-- Hidden input to store content -->
                                    <input type="hidden" name="content" id="content">
                                    <p class="mt-1 text-xs text-gray-500">
                                        You can use HTML, CSS, and JavaScript in your page content. All code will be
                                        rendered on the frontend.
                                    </p>
                                </div>

                                <!-- Attachments -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700" for="attachments">
                                        Attachments
                                    </label>
                                    <input
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        type="file" id="attachments" name="attachments" multiple>
                                    <p class="mt-1 text-xs text-gray-500">
                                        Allowed file types: JPG, PNG, PDF, Word, Excel, MP4. Max size: 50MB per file.
                                    </p>
                                </div>

                                <!-- Status -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700" for="status">
                                        Status <span class="text-red-500">*</span>
                                    </label>
                                    <select
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        id="status" name="status" required>
                                        <option value="draft">Draft</option>
                                        <option value="published">Published</option>
                                    </select>
                                </div>

                                <!-- Navigation Settings -->
                                <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="text-lg font-medium text-gray-700 mb-2">Navigation Settings</h3>

                                    <div class="flex items-center mb-2">
                                        <input type="checkbox" id="showInNavigation" name="showInNavigation"
                                            class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                        <label class="ml-2 text-sm text-gray-700" for="showInNavigation">
                                            Show in website navigation
                                        </label>
                                    </div>

                                    <div class="ml-6">
                                        <label class="block text-sm font-medium text-gray-700" for="navigationOrder">
                                            Navigation Order
                                        </label>
                                        <input
                                            class="block w-32 mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="number" id="navigationOrder" name="navigationOrder" min="0"
                                            placeholder="Order">
                                        <p class="mt-1 text-xs text-gray-500">
                                            Lower numbers appear first in navigation.
                                        </p>
                                    </div>
                                </div>

                                <!-- SEO Settings -->
                                <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="text-lg font-medium text-gray-700 mb-2">SEO Settings</h3>

                                    <div class="mb-2">
                                        <label class="block text-sm font-medium text-gray-700" for="metaTitle">
                                            Meta Title
                                        </label>
                                        <input
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="text" id="metaTitle" name="metaTitle"
                                            placeholder="Enter meta title (defaults to page title)">
                                    </div>

                                    <div class="mb-2">
                                        <label class="block text-sm font-medium text-gray-700" for="metaDescription">
                                            Meta Description
                                        </label>
                                        <textarea
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            id="metaDescription" name="metaDescription" rows="2"
                                            placeholder="Enter meta description"></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700" for="metaKeywords">
                                            Meta Keywords
                                        </label>
                                        <input
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="text" id="metaKeywords" name="metaKeywords"
                                            placeholder="Enter meta keywords (comma separated)">
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="flex items-center justify-between">
                                    <a href="/admin/pages"
                                        class="px-4 py-2 text-sm font-medium leading-5 text-gray-700 transition-colors duration-150 bg-white border border-gray-300 rounded-lg active:bg-gray-100 hover:bg-gray-50 focus:outline-none focus:shadow-outline-gray">
                                        Cancel
                                    </a>
                                    <button type="submit"
                                        class="px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-blue-600 border border-transparent rounded-lg active:bg-blue-600 hover:bg-blue-700 focus:outline-none focus:shadow-outline-blue">
                                        Create Page
                                    </button>
                                </div>
                            </form>
                        </div>
    </div>

    <%- contentFor('head') %>
        <!-- Include Quill CSS -->
        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

        <%- contentFor('scripts') %>
            <!-- Include Quill JS -->
            <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
            <script>
                // Initialize Quill editor
                var quill = new Quill('#editor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'align': [] }],
                            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                            ['link', 'image', 'video'],
                            ['clean'],
                            ['code-block']
                        ]
                    }
                });

                // Handle editor mode toggle
                const editorModeRadios = document.querySelectorAll('input[name="editorMode"]');
                const quillEditor = document.getElementById('editor');
                const htmlEditor = document.getElementById('htmlEditor');

                editorModeRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        if (this.value === 'editor') {
                            quillEditor.classList.remove('hidden');
                            htmlEditor.classList.add('hidden');

                            // Transfer content from HTML to Quill if there's content
                            if (htmlEditor.value.trim()) {
                                quill.clipboard.dangerouslyPasteHTML(htmlEditor.value);
                            }
                        } else {
                            quillEditor.classList.add('hidden');
                            htmlEditor.classList.remove('hidden');

                            // Transfer content from Quill to HTML
                            const quillHtml = quill.root.innerHTML;
                            htmlEditor.value = quillHtml;
                        }
                    });
                });

                // When form is submitted, update the hidden input with the active editor's contents
                document.getElementById('pageForm').addEventListener('submit', function () {
                    const content = document.getElementById('content');
                    const editorMode = document.querySelector('input[name="editorMode"]:checked').value;

                    if (editorMode === 'editor') {
                        // Store Quill content as Delta JSON
                        content.value = JSON.stringify(quill.getContents());
                    } else {
                        // Store raw HTML content
                        content.value = htmlEditor.value;
                    }
                });
            </script>