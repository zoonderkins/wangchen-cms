<%- contentFor('body') %>

<div class="container px-6 mx-auto grid">
    <h2 class="my-6 text-2xl font-semibold text-gray-700">
        Create New Page
    </h2>

    <div class="px-4 py-3 mb-8 bg-white rounded-lg shadow-md">
        <form action="/admin/pages" method="POST" class="space-y-6" onsubmit="return prepareFormData()">
            <div class="space-y-4">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
                    <input type="text" name="title" id="title" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>

                <div>
                    <label for="categoryId" class="block text-sm font-medium text-gray-700">Category</label>
                    <select name="categoryId" id="categoryId" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <% categories.forEach(function(category) { %>
                            <option value="<%= category.id %>"><%= category.name %></option>
                        <% }); %>
                    </select>
                </div>

                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                    <select name="status" id="status" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                    </select>
                </div>

                <div>
                    <label for="contentType" class="block text-sm font-medium text-gray-700">Content Type</label>
                    <select name="contentType" id="contentType" onchange="toggleEditor()" 
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="quill">Rich Text (Quill)</option>
                        <option value="raw">Raw HTML</option>
                    </select>
                </div>

                <div id="quillEditor">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Content (Rich Text)</label>
                    <div id="editor" style="height: 300px;"></div>
                </div>

                <div id="rawEditor" class="hidden">
                    <label for="rawContent" class="block text-sm font-medium text-gray-700">Content (Raw HTML)</label>
                    <textarea name="rawContent" id="rawContent" rows="12" 
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono"></textarea>
                </div>

                <input type="hidden" name="contentType" id="hiddenContentType">
                <input type="hidden" name="content" id="hiddenContent">
            </div>

            <div class="flex justify-end space-x-3">
                <a href="/admin/pages"
                    class="inline-flex justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Cancel
                </a>
                <button type="submit"
                    class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Create Page
                </button>
            </div>
        </form>
    </div>
</div>

<%- contentFor('head') %>
    <!-- Include Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<%- contentFor('scripts') %>
    <!-- Include Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'align': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link', 'image', 'video'],
                    ['clean']
                ]
            }
        });

        function toggleEditor() {
            const contentType = document.getElementById('contentType').value;
            const quillEditor = document.getElementById('quillEditor');
            const rawEditor = document.getElementById('rawEditor');
            const rawContent = document.getElementById('rawContent');

            if (contentType === 'raw') {
                quillEditor.classList.add('hidden');
                rawEditor.classList.remove('hidden');
                // Convert Quill content to raw HTML if switching from Quill
                if (!rawContent.value) {
                    rawContent.value = quill.root.innerHTML;
                }
            } else {
                quillEditor.classList.remove('hidden');
                rawEditor.classList.add('hidden');
                // Convert raw HTML to Quill content if switching from raw
                if (rawContent.value) {
                    quill.root.innerHTML = rawContent.value;
                }
            }
        }

        function prepareFormData() {
            const contentType = document.getElementById('contentType').value;
            document.getElementById('hiddenContentType').value = contentType;
            
            // Ensure we send a single contentType value
            if (contentType === 'raw') {
                document.getElementById('hiddenContent').value = document.getElementById('rawContent').value;
            } else {
                document.getElementById('hiddenContent').value = quill.root.innerHTML;
            }
            
            return true;
        }
    </script>