<%- contentFor('body') %>

    <div class="container px-6 mx-auto grid">
        <h2 class="my-6 text-2xl font-semibold text-gray-700">
            Create New Page
        </h2>

        <!-- Flash messages -->
        <% if (success_msg && success_msg.length> 0) { %>
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4" role="alert">
                <p>
                    <%= success_msg %>
                </p>
            </div>
            <% } %>

                <% if (error_msg && error_msg.length> 0) { %>
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert">
                        <p>
                            <%= error_msg %>
                        </p>
                    </div>
                    <% } %>

                        <!-- Page Creation Form -->
                        <div class="px-4 py-3 mb-8 bg-white rounded-lg shadow-md">
                            <form action="/admin/pages" method="POST" enctype="multipart/form-data" id="pageForm">
                                
                                <!-- Language Tabs -->
                                <div class="mb-6 border-b border-gray-200">
                                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="languageTabs" role="tablist">
                                        <li class="mr-2" role="presentation">
                                            <button class="inline-block p-4 border-b-2 border-blue-600 rounded-t-lg active" id="english-tab" 
                                                data-tabs-target="#english" type="button" role="tab" aria-controls="english" aria-selected="true">
                                                English
                                            </button>
                                        </li>
                                        <li class="mr-2" role="presentation">
                                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300" id="chinese-tab" 
                                                data-tabs-target="#chinese" type="button" role="tab" aria-controls="chinese" aria-selected="false">
                                                Traditional Chinese
                                            </button>
                                        </li>
                                    </ul>
                                </div>

                                <!-- English Content -->
                                <div id="english" role="tabpanel" aria-labelledby="english-tab">
                                    <!-- English Title -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700" for="title_en">
                                            Page Title (English) <span class="text-red-500">*</span>
                                        </label>
                                        <input
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="text" id="title_en" name="title_en" placeholder="Enter page title" required>
                                    </div>

                                    <!-- Editor Mode Toggle -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Editor Mode
                                        </label>
                                        <div class="flex">
                                            <div class="flex items-center mr-4">
                                                <input type="radio" id="editorMode-editor" name="editorMode" value="editor"
                                                    checked
                                                    class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                                <label for="editorMode-editor" class="ml-2 block text-sm text-gray-700">
                                                    Rich Text Editor
                                                </label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="radio" id="editorMode-html" name="editorMode" value="html"
                                                    class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                                <label for="editorMode-html" class="ml-2 block text-sm text-gray-700">
                                                    Raw HTML
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- English Content -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700" for="editor_en">
                                            Page Content (English) <span class="text-red-500">*</span>
                                        </label>
                                        <!-- Quill editor container -->
                                        <div id="editor_en"
                                            class="block w-full mt-1 text-sm border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            style="min-height: 300px;"></div>

                                        <!-- HTML textarea (initially hidden) -->
                                        <textarea id="htmlEditor_en"
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 hidden"
                                            style="min-height: 300px; font-family: monospace;"
                                            placeholder="Enter HTML content here"></textarea>

                                        <!-- Hidden input to store content -->
                                        <input type="hidden" name="content_en" id="content_en">
                                    </div>

                                    <!-- English SEO Settings -->
                                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                        <h3 class="text-lg font-medium text-gray-700 mb-2">SEO Settings (English)</h3>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaTitle_en">
                                                Meta Title (English)
                                            </label>
                                            <input
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                type="text" id="metaTitle_en" name="metaTitle_en"
                                                placeholder="Enter meta title (defaults to page title)">
                                        </div>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaDescription_en">
                                                Meta Description (English)
                                            </label>
                                            <textarea
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                id="metaDescription_en" name="metaDescription_en" rows="2"
                                                placeholder="Enter meta description"></textarea>
                                        </div>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaKeywords_en">
                                                Meta Keywords (English)
                                            </label>
                                            <input
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                type="text" id="metaKeywords_en" name="metaKeywords_en"
                                                placeholder="Enter meta keywords (comma separated)">
                                        </div>
                                    </div>
                                </div>

                                <!-- Traditional Chinese Content -->
                                <div id="chinese" class="hidden" role="tabpanel" aria-labelledby="chinese-tab">
                                    <!-- Chinese Title -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700" for="title_tw">
                                            Page Title (Traditional Chinese) <span class="text-red-500">*</span>
                                        </label>
                                        <input
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="text" id="title_tw" name="title_tw" placeholder="輸入頁面標題" required>
                                    </div>

                                    <!-- Chinese Content -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700" for="editor_tw">
                                            Page Content (Traditional Chinese) <span class="text-red-500">*</span>
                                        </label>
                                        <!-- Quill editor container -->
                                        <div id="editor_tw"
                                            class="block w-full mt-1 text-sm border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            style="min-height: 300px;"></div>

                                        <!-- HTML textarea (initially hidden) -->
                                        <textarea id="htmlEditor_tw"
                                            class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 hidden"
                                            style="min-height: 300px; font-family: monospace;"
                                            placeholder="在此輸入HTML內容"></textarea>

                                        <!-- Hidden input to store content -->
                                        <input type="hidden" name="content_tw" id="content_tw">
                                    </div>

                                    <!-- Chinese SEO Settings -->
                                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                        <h3 class="text-lg font-medium text-gray-700 mb-2">SEO Settings (Traditional Chinese)</h3>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaTitle_tw">
                                                Meta Title (Traditional Chinese)
                                            </label>
                                            <input
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                type="text" id="metaTitle_tw" name="metaTitle_tw"
                                                placeholder="輸入元標題 (默認為頁面標題)">
                                        </div>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaDescription_tw">
                                                Meta Description (Traditional Chinese)
                                            </label>
                                            <textarea
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                id="metaDescription_tw" name="metaDescription_tw" rows="2"
                                                placeholder="輸入元描述"></textarea>
                                        </div>

                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700" for="metaKeywords_tw">
                                                Meta Keywords (Traditional Chinese)
                                            </label>
                                            <input
                                                class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                type="text" id="metaKeywords_tw" name="metaKeywords_tw"
                                                placeholder="輸入元關鍵詞 (以逗號分隔)">
                                        </div>
                                    </div>
                                </div>

                                <!-- Common Fields (Not Language Specific) -->
                                <!-- Attachments -->
                                <div class="mb-4 mt-6 pt-4 border-t border-gray-200">
                                    <label class="block text-sm font-medium text-gray-700" for="attachments">
                                        Attachments
                                    </label>
                                    <input
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        type="file" id="attachments" name="attachments" multiple>
                                    <p class="mt-1 text-xs text-gray-500">
                                        Allowed file types: JPG, PNG, PDF, Word, Excel, MP4. Max size: 50MB per file.
                                    </p>
                                </div>

                                <!-- Status -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700" for="status">
                                        Status <span class="text-red-500">*</span>
                                    </label>
                                    <select
                                        class="block w-full mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                        id="status" name="status" required>
                                        <option value="draft">Draft</option>
                                        <option value="published">Published</option>
                                    </select>
                                </div>

                                <!-- Navigation Settings -->
                                <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="text-lg font-medium text-gray-700 mb-2">Navigation Settings</h3>

                                    <div class="flex items-center mb-2">
                                        <input type="checkbox" id="showInNavigation" name="showInNavigation"
                                            class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                        <label class="ml-2 text-sm text-gray-700" for="showInNavigation">
                                            Show in website navigation
                                        </label>
                                    </div>

                                    <div class="ml-6">
                                        <label class="block text-sm font-medium text-gray-700" for="navigationOrder">
                                            Navigation Order
                                        </label>
                                        <input
                                            class="block w-32 mt-1 text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            type="number" id="navigationOrder" name="navigationOrder" min="0"
                                            placeholder="Order">
                                        <p class="mt-1 text-xs text-gray-500">
                                            Lower numbers appear first in navigation.
                                        </p>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="mt-6 flex justify-end">
                                    <button type="submit"
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                        Create Page
                                    </button>
                                </div>
                            </form>
                        </div>
    </div>

<!-- Include Quill JS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    // Initialize Quill editors
    const quillOptions = {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image', 'video'],
                ['clean']
            ]
        }
    };

    var quill_en = new Quill('#editor_en', quillOptions);
    var quill_tw = new Quill('#editor_tw', quillOptions);
    
    // Handle editor mode toggle
    const editorModeRadios = document.querySelectorAll('input[name="editorMode"]');
    const quillContainers = [document.getElementById('editor_en'), document.getElementById('editor_tw')];
    const htmlEditors = [document.getElementById('htmlEditor_en'), document.getElementById('htmlEditor_tw')];
    
    editorModeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'editor') {
                quillContainers.forEach(container => container.classList.remove('hidden'));
                htmlEditors.forEach(editor => editor.classList.add('hidden'));
            } else {
                quillContainers.forEach(container => container.classList.add('hidden'));
                htmlEditors.forEach(editor => editor.classList.remove('hidden'));
            }
        });
    });

    // Handle language tabs
    const tabs = document.querySelectorAll('[data-tabs-target]');
    const tabContents = document.querySelectorAll('[role="tabpanel"]');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = document.querySelector(tab.dataset.tabsTarget);
            
            tabContents.forEach(tabContent => {
                tabContent.classList.add('hidden');
            });
            
            tabs.forEach(tab => {
                tab.classList.remove('active', 'border-blue-600');
                tab.classList.add('border-transparent');
                tab.setAttribute('aria-selected', false);
            });
            
            tab.classList.add('active', 'border-blue-600');
            tab.classList.remove('border-transparent');
            tab.setAttribute('aria-selected', true);
            
            target.classList.remove('hidden');
        });
    });
    
    // Handle form submission
    document.getElementById('pageForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const editorMode = document.querySelector('input[name="editorMode"]:checked').value;
        
        if (editorMode === 'editor') {
            // Get Quill content
            document.getElementById('content_en').value = JSON.stringify(quill_en.getContents());
            document.getElementById('content_tw').value = JSON.stringify(quill_tw.getContents());
        } else {
            // Get HTML content
            document.getElementById('content_en').value = document.getElementById('htmlEditor_en').value;
            document.getElementById('content_tw').value = document.getElementById('htmlEditor_tw').value;
        }
        
        this.submit();
    });
</script>