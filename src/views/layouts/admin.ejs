<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= typeof title !=='undefined' ? title + ' - ' : '' %>Wangchen CMS
    </title>

    <!-- Base Styles -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <style>
        .dropdown-menu {
            display: none;
            z-index: 50;
        }

        .dropdown-menu.show {
            display: block;
        }
    </style>

    <!-- Additional Styles -->
    <%- style %>
</head>

<body class="bg-gray-100">
    <nav class="bg-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <a href="/admin/dashboard" class="text-white font-bold text-xl">Wangchen CMS</a>
                    </div>
                    <% if (typeof user !=='undefined' && user) { %>
                        <div class="hidden md:block">
                            <div class="ml-10 flex items-baseline space-x-4">
                                <!-- <a href="/admin/dashboard"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                                <a href="/admin/articles"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Articles</a>
                                <a href="/admin/pages"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Pages</a>
                                <a href="/admin/media"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Media</a>
                                <a href="/admin/categories"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Categories</a> -->
                                <a href="/admin/banners"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">橫幅</a>
                                <a href="/admin/downloads"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">下載</a>
                                <a href="/admin/news"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">新聞</a>
                                <a href="/admin/promotions"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">促銷</a>
                                <a href="/admin/about"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">關於</a>
                                <div class="relative inline-block text-left dropdown">
                                    <button type="button"
                                        class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium dropdown-toggle">
                                        常見問題 <i class="fas fa-chevron-down ml-1"></i>
                                    </button>
                                    <div
                                        class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 dropdown-menu">
                                        <div class="py-1" role="menu" aria-orientation="vertical">
                                            <a href="/admin/faq/categories"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                                role="menuitem">分類</a>
                                            <a href="/admin/faq/items"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                                role="menuitem">問題項目</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="relative inline-block text-left dropdown">
                                    <button type="button"
                                        class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium dropdown-toggle">
                                        聯絡 <i class="fas fa-chevron-down ml-1"></i>
                                    </button>
                                    <div
                                        class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 dropdown-menu">
                                        <div class="py-1" role="menu" aria-orientation="vertical">
                                            <a href="/admin/contact"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                                role="menuitem">提交</a>
                                            <a href="/admin/contact/categories"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                                role="menuitem">分類</a>
                                        </div>
                                    </div>
                                </div>
                                <a href="/admin/links"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">連結</a>
                                <a href="/admin/platforms"
                                    class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">平台</a>
                                <% if (user.role && user.role==='super_admin' ) { %>
                                    <a href="/admin/users"
                                        class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">用戶</a>
                                    <% } %>
                            </div>
                        </div>
                        <% } %>
                </div>
                <div class="hidden md:block">
                    <div class="ml-4 flex items-center md:ml-6">
                        <% if (typeof user !=='undefined' && user) { %>
                            <div class="flex items-center">
                                <span class="text-gray-300 mr-4">
                                    <%= user.username %>
                                </span>
                                <a href="/admin/logout" class="text-gray-300 hover:text-white">
                                    <i class="fas fa-sign-out-alt"></i>
                                </a>
                            </div>
                            <% } else { %>
                                <a href="/admin/login" class="text-gray-300 hover:text-white">
                                    <i class="fas fa-sign-in-alt"></i> 登入
                                </a>
                                <% } %>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu, show/hide based on menu state -->
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="/admin/dashboard"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">儀表板</a>
                <a href="/admin/articles"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">文章</a>
                <a href="/admin/pages"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">頁面</a>
                <a href="/admin/media"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">媒體</a>
                <a href="/admin/categories"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">分類</a>
                <a href="/admin/banners"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">橫幅</a>
                <a href="/admin/downloads"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">下載</a>
                <a href="/admin/news"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">新聞</a>
                <a href="/admin/promotions"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">促銷</a>
                <a href="/admin/about"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">關於</a>
                <div class="border-t border-gray-700 my-1"></div>
                <a href="/admin/faq/categories"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">常見問題
                    分類</a>
                <a href="/admin/faq/items"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">常見問題
                    項目</a>
                <div class="border-t border-gray-700 my-1"></div>
                <a href="/admin/contact"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">聯絡
                    提交</a>
                <a href="/admin/contact/categories"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">聯絡
                    分類</a>
                <div class="border-t border-gray-700 my-1"></div>
                <a href="/admin/links"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">連結</a>
                <a href="/admin/platforms"
                    class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">平台</a>
                <% if (typeof user !=='undefined' && user && user.role && user.role==='super_admin' ) { %>
                    <a href="/admin/users"
                        class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">用戶</a>
                    <% } %>
                        <% if (typeof user !=='undefined' && user) { %>
                            <div class="border-t border-gray-700 pt-4 pb-3">
                                <div class="flex items-center px-5">
                                    <div class="text-base font-medium leading-none text-white">
                                        <%= user.username %>
                                    </div>
                                </div>
                                <div class="mt-3 px-2">
                                    <a href="/admin/logout"
                                        class="block px-3 py-2 rounded-md text-base font-medium text-gray-400 hover:text-white hover:bg-gray-700">登出</a>
                                </div>
                            </div>
                            <% } %>
            </div>
        </div>
    </nav>

    <% if (typeof success_msg !=='undefined' && success_msg.length> 0) { %>
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4" role="alert">
            <p>
                <%= success_msg %>
            </p>
        </div>
        <% } %>

            <% if (typeof error_msg !=='undefined' && error_msg.length> 0) { %>
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert">
                    <p>
                        <%= error_msg %>
                    </p>
                </div>
                <% } %>

                    <%- defineContent('header') %>

                        <%- defineContent('breadcrumbs') %>

                            <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                                <%- body %>
                            </main>

                            <footer class="bg-white shadow mt-8 py-4">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <p class="text-center text-gray-500 text-sm">
                                        &copy; <%= new Date().getFullYear() %> Wangchen CMS. 版權所有。
                                    </p>
                                </div>
                            </footer>

                            <!-- Scripts -->
                            <%- script %>

                                <script>
                                    // Mobile menu toggle
                                    document.getElementById('mobile-menu-button').addEventListener('click', function () {
                                        const mobileMenu = document.getElementById('mobile-menu');
                                        mobileMenu.classList.toggle('hidden');
                                    });

                                    // Dropdown toggles
                                    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
                                    const dropdownMenus = document.querySelectorAll('.dropdown-menu');

                                    // Add click event to each dropdown toggle
                                    dropdownToggles.forEach(function (toggle, index) {
                                        toggle.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            // Close all other dropdowns
                                            dropdownMenus.forEach(function (menu, menuIndex) {
                                                if (menuIndex !== index) {
                                                    menu.classList.remove('show');
                                                }
                                            });
                                            // Toggle current dropdown
                                            dropdownMenus[index].classList.toggle('show');
                                        });
                                    });

                                    // Close dropdowns when clicking outside
                                    document.addEventListener('click', function (e) {
                                        const dropdowns = document.querySelectorAll('.dropdown');
                                        let clickedInside = false;

                                        dropdowns.forEach(function (dropdown) {
                                            if (dropdown.contains(e.target)) {
                                                clickedInside = true;
                                            }
                                        });

                                        if (!clickedInside) {
                                            dropdownMenus.forEach(function (menu) {
                                                menu.classList.remove('show');
                                            });
                                        }
                                    });
                                </script>
</body>

</html>