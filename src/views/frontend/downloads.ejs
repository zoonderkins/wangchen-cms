<%- contentFor('body') %>
    <section class="relative">
        <picture class="block w-full h-full">
            <source media="(min-width: 1024px)" srcset="../images/desktop/aboutbg_desktop.png">
            <source media="(min-width: 640px)" srcset="../images/tablet/aboutbg_tablet.png">
            <img class="w-full h-full object-cover" src="../images/mobile/aboutbg_mobile.png" alt="響應式圖片">
        </picture>
        <div class="absolute inset-0 flex flex-col justify-center px-6 sm:px-16 lg:px-32">
            <h2 class="text-white"><%= title %></h2>
            <p class="text-white">/ <%= currentLanguage==='en' ? 'Home' : '首頁' %> - <%= title %> /</p>
        </div>
    </section>

    <!-- Divider -->
    <div class="w-screen relative" style="left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw;">
        <hr class="border-t-2 border-gray-200 mb-16">
    </div>

    <!-- Download categories -->
    <section id="aboutplatform" class="px-6 pb-8 sm:px-16 sm:pb-16 lg:px-32">
        <div class="bg-custom-lightblue rounded-3xl border border-custom-green px-4 py-8 mb-12 sm:px-16">
            <h4 class="text-center mb-4 sm:mb-12 text-custom-blue"><%= language === 'en' ? 'Download Categories' : '下載分類' %></h4>

            <div class="bg-white p-2 mb-4 relative rounded-xl border">
                <form action="/<%= language %>/downloads" method="GET" class="flex gap-2">
                <select name="category"
                    class="w-full  text-gray-600 border-0 focus:ring-0 focus:outline-none py-2 pl-2 pr-10 appearance-none"
                    onchange="this.form.submit()">
                    <option value=""><%= language === 'tw' ? '全部分類' : 'All Categories' %></option>
                    <% categories.forEach(function(category) { %>
                        <option value="<%= category.id %>"
                            <%=filters.category===category.id.toString() ? 'selected' : '' %>>
                            <%= category.name %>
                        </option>
                        <% }); %>
                </select>
                </form>
                <!-- 自定義下拉箭頭 -->
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="relative">
                <form action="/downloads" method="GET" class="flex gap-2">
                    <input type="text" name="search" placeholder="<%= language === 'tw' ? '搜尋下載項目...' : 'Search downloads...' %>" value="<%= filters.search %>"
                        class="w-full px-4 py-4 border rounded-xl">
                    <button class="absolute right-3 top-4" type="submit">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </form>
                
            </div>
        </div>
    </section>

    <!-- Download List -->
    <% if (locals.downloads && downloads.length> 0) { %>
    <section id="downloadList" class="px-6 pb-8 sm:px-16 sm:pb-16 lg:px-32">
        <% downloads.forEach(function(download) { %>
        <!-- File 1 -->
        <div>
            <h5 class="mb-6"><%= download.title %></h5>
            <!-- 橫幅卡片 -->
            <div class="bg-gray-100 rounded-2xl">
                <div class="flex items-center justify-between px-6 py-2">
                    <!-- 標題部分 -->
                    <p class=""><%= download.description %></p>
                    
                    <!-- 下載按鈕部分 -->
                    <a href="/<%= language %>/downloads/<%= download.id %>" class="inline-flex items-center px-0 sm:px-5 py-0">
                        <img src="../images/downloadcloud.png" alt="下載雲" class="h-8 mr-0 sm:mr-2 object-contain">
                        <span class="hidden sm:block"><%= language === 'en' ? 'Download' : '檔案下載' %></span>
                    </a>
                </div>
            </div>
        </div>
        <!-- Divider -->
        <div class="my-8">
            <hr class="border-t-2 border-gray-200">
        </div>
        
        <% }); %>
    </section>
    <% } %>


    <div class="bg-gradient-to-b from-gray-50 to-white min-h-screen py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header with animation -->
            <div class="text-center mb-12 animate-fade-in">
                <h1
                    class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 mb-4">
                    <%= language === 'tw' ? '下載專區' : 'Downloads' %></h1>
                <p class="text-lg text-gray-600"><%= language === 'tw' ? '瀏覽並下載我們的資源' : 'Browse and download our resources' %></p>
            </div>

            <!-- Search and Filter Section -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8 backdrop-blur-sm bg-white/80">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Search with improved styling -->
                    <div class="md:col-span-2">
                        <form action="/downloads" method="GET" class="flex gap-2">
                            <div class="flex-1 relative">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" name="search"
                                    class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150"
                                    placeholder="<%= language === 'tw' ? '搜尋下載項目...' : 'Search downloads...' %>" value="<%= filters.search %>">
                            </div>
                            <button type="submit"
                                class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150">
                                <%= language === 'tw' ? '搜尋' : 'Search' %>
                            </button>
                        </form>
                    </div>
                    <!-- Category Filter with improved dropdown -->
                    <% if (locals.categories && categories.length> 0) { %>
                        <div class="md:col-span-1">
                            <form action="/<%= language %>/downloads" method="GET" class="flex gap-2">
                                <div class="flex-1 relative">
                                    <i
                                        class="fas fa-folder absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <select name="category"
                                        class="w-full appearance-none pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150"
                                        onchange="this.form.submit()">
                                        <option value=""><%= language === 'tw' ? '全部分類' : 'All Categories' %></option>
                                        <% categories.forEach(function(category) { %>
                                            <option value="<%= category.id %>"
                                                <%=filters.category===category.id.toString() ? 'selected' : '' %>>
                                                <%= category.name %>
                                            </option>
                                            <% }); %>
                                    </select>
                                    <i
                                        class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                </div>
                                <% if (filters.category) { %>
                                    <a href="/<%= language %>/downloads"
                                        class="px-4 py-2.5 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-150">
                                        <%= language === 'tw' ? '清除' : 'Clear' %>
                                    </a>
                                    <% } %>
                            </form>
                        </div>
                        <% } %>
                </div>
            </div>

            <% if (locals.downloads && downloads.length> 0) { %>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <% downloads.forEach(function(download) { %>
                        <div
                            class="bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <div class="p-6">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                            <%= download.title %>
                                        </h3>
                                        <% if (download.category) { %>
                                            <span
                                                class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-50 text-blue-700">
                                                <i class="fas fa-folder-open mr-1.5 text-blue-500"></i>
                                                <%= download.category.name %>
                                            </span>
                                            <% } %>
                                    </div>
                                    <% let icon='fa-file' ; let iconColor='text-gray-500' ; if
                                        (download.mimeType.includes('pdf')) { icon='fa-file-pdf' ;
                                        iconColor='text-red-500' ; } else if (download.mimeType.includes('word')) {
                                        icon='fa-file-word' ; iconColor='text-blue-500' ; } else if
                                        (download.mimeType.includes('excel') ||
                                        download.mimeType.includes('spreadsheet')) { icon='fa-file-excel' ;
                                        iconColor='text-green-500' ; } else if (download.mimeType.includes('image')) {
                                        icon='fa-file-image' ; iconColor='text-purple-500' ; } else if
                                        (download.mimeType.includes('zip') || download.mimeType.includes('rar')) {
                                        icon='fa-file-archive' ; iconColor='text-yellow-500' ; } %>
                                        <div class="p-3 bg-gray-50 rounded-lg">
                                            <i class="fas <%= icon %> <%= iconColor %> text-3xl"></i>
                                        </div>
                                </div>

                                <% if (download.description) { %>
                                    <p class="mt-4 text-gray-600 line-clamp-2">
                                        <%= download.description %>
                                    </p>
                                    <% } %>

                                        <div class="mt-6 flex items-center justify-between">
                                            <div class="text-sm text-gray-500">
                                                <div class="flex items-center">
                                                    <i class="fas fa-file-alt mr-2"></i>
                                                    <%= download.originalName %>
                                                </div>
                                                <div class="flex items-center mt-1">
                                                    <i class="fas fa-weight mr-2"></i>
                                                    <%= (download.size / 1024).toFixed(2) %> KB
                                                </div>
                                            </div>
                                            <a href="/<%= language %>/downloads/<%= download.id %>"
                                                class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 transform hover:scale-105">
                                                <i class="fas fa-download mr-2"></i>
                                                <%= language === 'tw' ? '下載' : 'Download' %>
                                            </a>
                                        </div>
                            </div>
                        </div>
                        <% }); %>
                </div>

                <% if (pagination.totalPages> 1) { %>
                    <div class="mt-8">
                        <nav class="flex justify-center" aria-label="Pagination">
                            <ul class="inline-flex items-center -space-x-px">
                                <% if (pagination.hasPrevPage) { %>
                                    <li>
                                        <a href="/<%= language %>/downloads?page=<%= pagination.current - 1 %><%= filters.search ? '&search=' + filters.search : '' %><%= filters.category ? '&category=' + filters.category : '' %>"
                                            class="px-4 py-2 rounded-l-lg text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 transition duration-150">
                                            <i class="fas fa-chevron-left mr-1"></i>
                                            <%= language === 'tw' ? '上一頁' : 'Previous' %>
                                        </a>
                                    </li>
                                    <% } %>

                                        <% for(let i=1; i <=pagination.totalPages; i++) { %>
                                            <li>
                                                <a href="/<%= language %>/downloads?page=<%= i %><%= filters.search ? '&search=' + filters.search : '' %><%= filters.category ? '&category=' + filters.category : '' %>"
                                                    class="px-4 py-2 text-sm font-medium <%= pagination.current === i ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-blue-600' : 'text-gray-700 bg-white border-gray-300 hover:bg-gray-50' %> border transition duration-150">
                                                    <%= i %>
                                                </a>
                                            </li>
                                            <% } %>

                                                <% if (pagination.hasNextPage) { %>
                                                    <li>
                                                        <a href="/<%= language %>/downloads?page=<%= pagination.current + 1 %><%= filters.search ? '&search=' + filters.search : '' %><%= filters.category ? '&category=' + filters.category : '' %>"
                                                            class="px-4 py-2 rounded-r-lg text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 transition duration-150">
                                                            <%= language === 'tw' ? '下一頁' : 'Next' %>
                                                            <i class="fas fa-chevron-right ml-1"></i>
                                                        </a>
                                                    </li>
                                                    <% } %>
                            </ul>
                        </nav>
                    </div>
                    <% } %>

                        <% } else { %>
                            <!-- Empty State with improved styling -->
                            <div class="text-center py-16">
                                <div
                                    class="rounded-full bg-gradient-to-br from-gray-100 to-gray-50 p-8 mx-auto w-24 h-24 flex items-center justify-center mb-6 shadow-inner">
                                    <i class="fas fa-inbox text-4xl text-gray-400"></i>
                                </div>
                                <h3 class="text-xl font-medium text-gray-900 mb-3"><%= language === 'tw' ? '沒有找到下載項目' : 'No downloads found' %></h3>
                                <p class="text-gray-600 max-w-md mx-auto">
                                    <% if (filters.search || filters.category) { %>
                                        <%= language === 'tw' ? '沒有符合搜尋條件的下載項目。' : 'No downloads match your search criteria.' %><a href="/<%= language %>/downloads"
                                            class="text-blue-600 hover:text-blue-800 font-medium transition duration-150"><%= language === 'tw' ? '查看所有下載' : 'View all downloads' %></a>
                                        <% } else { %>
                                            <%= language === 'tw' ? '目前沒有可供下載的項目。' : 'There are currently no downloads available.' %>
                                            <% } %>
                                </p>
                            </div>
                            <% } %>
        </div>
    </div>

    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.6s ease-out;
        }
    </style>